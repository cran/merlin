<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Emma Martin" />

<meta name="date" content="2018-08-15" />

<title>merlin</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">merlin</h1>
<h4 class="author"><em>Emma Martin</em></h4>
<h4 class="date"><em>2018-08-15</em></h4>



<div id="description" class="section level2">
<h2>Description</h2>
<p>The merlin package allows the fitting of multi outcome models and with any number of nested random effects, outcomes can be modelled jointly, or with shared random effects.</p>
</div>
<div id="missing-data" class="section level2">
<h2>Missing data</h2>
<p>For n record to be included in the model there must be at least one observation per level in the model. For example in a joint survival and longitudinal biomarker model, if the survival time for a patient is avaliable, but all longitudinal biomarker observations are missing, the individual will be excluded from the analysis.</p>
<p>For each individual outcome in the model, a complete case analysis is used. The response, covariates and level indicators are required to fit the model, which may vary by outcome. For example if a model simultaneously models two seperate biomarkers, which are sampled at different time points, data in each record will only be included in the model for the appropriate outcome, potentially resulting in different sample sizes being used for each outcome.</p>
</div>
<div id="variance-covariance-matrix-structure" class="section level2">
<h2>Variance-covariance matrix structure</h2>
<p>There is a separate variance-covariance matrix for each level of random effects. The structure of the variance-covariance matrix can be varied to allow for correlation between parameters at each level. The possible structures are <code>identity</code>, where all diagonal elements are estimated and constrained to be the same, <code>diagonal</code> where all diagonal elements are estimated uniquely (the default), <code>unstructured</code> where all elements of the variance-covariance matrix are estimated, and <code>exchangeable</code> which assumes a common variance and a common covariance.</p>
</div>
<div id="predictions" class="section level2">
<h2>Predictions</h2>
<p>Predictions using the fixed-effects only can be found using the <code>predict()</code> function with the argument <code>type = fixedonly</code>. Marginal predictions, where the random effects are integrated out, can be obtained using <code>type = marginal</code>.</p>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>In order to illustrate the potential uses of <code>merlin</code> a number of increasingly advanced models have been fitted to the commonly used (in the area of joint modelling of longitudinal and survival data) primary biliary cirrhosis dataset.</p>
<p>This data set needs some re-formatting in order to fit joint models</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(merlin)
<span class="kw">data</span>(<span class="st">&quot;pbc&quot;</span>)
pbc[<span class="dv">1</span><span class="op">:</span><span class="dv">11</span>,<span class="kw">c</span>(<span class="st">&quot;id&quot;</span>,<span class="st">&quot;years&quot;</span>,<span class="st">&quot;status&quot;</span>,<span class="st">&quot;status2&quot;</span>,<span class="st">&quot;drug&quot;</span>,<span class="st">&quot;serBilir&quot;</span>,<span class="st">&quot;prothrombin&quot;</span>,<span class="st">&quot;year&quot;</span>)]
<span class="co">#&gt;    id    years status status2      drug serBilir prothrombin      year</span>
<span class="co">#&gt; 1   1  1.09517   dead       1 D-penicil     14.5        12.2 0.0000000</span>
<span class="co">#&gt; 2   1  1.09517   dead       1 D-penicil     21.3        11.2 0.5256817</span>
<span class="co">#&gt; 3   2 14.15234  alive       0 D-penicil      1.1        10.6 0.0000000</span>
<span class="co">#&gt; 4   2 14.15234  alive       0 D-penicil      0.8        11.0 0.4983025</span>
<span class="co">#&gt; 5   2 14.15234  alive       0 D-penicil      1.0        11.6 0.9993429</span>
<span class="co">#&gt; 6   2 14.15234  alive       0 D-penicil      1.9        10.6 2.1027270</span>
<span class="co">#&gt; 7   2 14.15234  alive       0 D-penicil      2.6        11.3 4.9008871</span>
<span class="co">#&gt; 8   2 14.15234  alive       0 D-penicil      3.6        11.5 5.8892783</span>
<span class="co">#&gt; 9   2 14.15234  alive       0 D-penicil      4.2        11.5 6.8858833</span>
<span class="co">#&gt; 10  2 14.15234  alive       0 D-penicil      3.6        11.5 7.8907020</span>
<span class="co">#&gt; 11  2 14.15234  alive       0 D-penicil      4.6        11.5 8.8325485</span></code></pre></div>
<p>The event times are given in the <code>years</code> variable and the event indicator in the <code>status</code> variable which can take the values alive, dead or transplanted or the <code>status2</code> variable which is 0 for alive and 1 for dead. Each survival observation should only appear once for each individudal, otherwise each observation will be treated as a seperate event, this allows for recurrent events to be modelled. The survival observations can be reformatted as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pbc<span class="op">$</span>stime &lt;-<span class="st"> </span>pbc<span class="op">$</span>years
pbc<span class="op">$</span>stime[<span class="kw">duplicated</span>(pbc<span class="op">$</span>id)] &lt;-<span class="st"> </span><span class="ot">NA</span>
pbc<span class="op">$</span>died &lt;-<span class="st"> </span>pbc<span class="op">$</span>status2
pbc<span class="op">$</span>died[<span class="kw">duplicated</span>(pbc<span class="op">$</span>id)] &lt;-<span class="st"> </span><span class="ot">NA</span></code></pre></div>
<p>We are also going to work with the log of biomarkers prothrombin index and serum bilirubin throughout, the time of this measurments will be recorded in the variable time. We will also change the treatment variable to be numeric rather than a factor variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pbc<span class="op">$</span>logb &lt;-<span class="st"> </span><span class="kw">log</span>(pbc<span class="op">$</span>serBilir) 
pbc<span class="op">$</span>logp &lt;-<span class="st"> </span><span class="kw">log</span>(pbc<span class="op">$</span>prothrombin)
pbc<span class="op">$</span>time &lt;-<span class="st"> </span>pbc<span class="op">$</span>year
pbc<span class="op">$</span>trt &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(pbc<span class="op">$</span>drug) <span class="op">-</span><span class="st"> </span><span class="dv">1</span></code></pre></div>
<p>The data now looks like this. Failing to set the data up in this way will lead to errors in the parameter estimates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pbc[<span class="dv">1</span><span class="op">:</span><span class="dv">11</span>,<span class="kw">c</span>(<span class="st">&quot;id&quot;</span>,<span class="st">&quot;stime&quot;</span>,<span class="st">&quot;died&quot;</span>,<span class="st">&quot;logb&quot;</span>,<span class="st">&quot;logp&quot;</span>,<span class="st">&quot;time&quot;</span>)]
<span class="co">#&gt;    id    stime died        logb     logp      time</span>
<span class="co">#&gt; 1   1  1.09517    1  2.67414865 2.501436 0.0000000</span>
<span class="co">#&gt; 2   1       NA   NA  3.05870707 2.415914 0.5256817</span>
<span class="co">#&gt; 3   2 14.15234    0  0.09531018 2.360854 0.0000000</span>
<span class="co">#&gt; 4   2       NA   NA -0.22314355 2.397895 0.4983025</span>
<span class="co">#&gt; 5   2       NA   NA  0.00000000 2.451005 0.9993429</span>
<span class="co">#&gt; 6   2       NA   NA  0.64185389 2.360854 2.1027270</span>
<span class="co">#&gt; 7   2       NA   NA  0.95551145 2.424803 4.9008871</span>
<span class="co">#&gt; 8   2       NA   NA  1.28093385 2.442347 5.8892783</span>
<span class="co">#&gt; 9   2       NA   NA  1.43508453 2.442347 6.8858833</span>
<span class="co">#&gt; 10  2       NA   NA  1.28093385 2.442347 7.8907020</span>
<span class="co">#&gt; 11  2       NA   NA  1.52605630 2.442347 8.8325485</span></code></pre></div>
<p>We can fit a simple linear model</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lin.model &lt;-<span class="st"> </span><span class="kw">merlin</span>(logb <span class="op">~</span><span class="st"> </span>time, <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="dt">data =</span> pbc)
lin.model
<span class="co">#&gt; Merlin: mixed-effects model </span>
<span class="co">#&gt; Data: pbc</span>
<span class="co">#&gt; Log likelihood = -2961.414</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results:</span>
<span class="co">#&gt;                     Coef. Std. Error     z P&gt;|z| [95% Conf. Interval]</span>
<span class="co">#&gt; time           0.01391608  0.0081279  1.71 0.087 -0.0020143 0.0298465</span>
<span class="co">#&gt; _cons          0.55956049  0.0358059 15.63 0.000  0.4893822 0.6297388</span>
<span class="co">#&gt; log_sd(resid.) 0.10354032  0.0160318  6.46 0.000  0.0721186 0.1349621</span>
<span class="kw">summary</span>(lin.model)
<span class="co">#&gt; Mixed effects regression model </span>
<span class="co">#&gt; Log likelihood = -2961.414</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                     Coef. Std. Error     z P&gt;|z| [95% Conf. Interval]</span>
<span class="co">#&gt; time           0.01391608  0.0081279  1.71 0.087 -0.0020143 0.0298465</span>
<span class="co">#&gt; _cons          0.55956049  0.0358059 15.63 0.000  0.4893822 0.6297388</span>
<span class="co">#&gt; log_sd(resid.) 0.10354032  0.0160318  6.46 0.000  0.0721186 0.1349621</span></code></pre></div>
<p>We can add flexibility to the model using restricted cubic splines:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rcs.model &lt;-<span class="st"> </span><span class="kw">merlin</span>(logb <span class="op">~</span><span class="st"> </span><span class="kw">rcs</span>(time, <span class="dt">df =</span> <span class="dv">3</span>), <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="dt">timevar =</span> <span class="st">&quot;time&quot;</span>, <span class="dt">data =</span> pbc)
<span class="kw">summary</span>(rcs.model)
<span class="co">#&gt; Mixed effects regression model </span>
<span class="co">#&gt; Log likelihood = -2960.733</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                       Coef. Std. Error     z P&gt;|z| [95% Conf. Interval]</span>
<span class="co">#&gt; rcs():1         0.043259677  0.0251475  1.72 0.085 -0.0060285 0.0925479</span>
<span class="co">#&gt; rcs():2         0.028845143  0.0251475  1.15 0.250 -0.0204431 0.0781333</span>
<span class="co">#&gt; rcs():3        -0.009251053  0.0251475 -0.37 0.711 -0.0585392 0.0400371</span>
<span class="co">#&gt; _cons           0.603291290  0.0251475 23.99 0.000  0.5540031 0.6525795</span>
<span class="co">#&gt; log_sd(resid.)  0.103511139  0.0160369  6.45 0.000  0.0720794 0.1349429</span></code></pre></div>
<p>By default, the restricted cubic splines are orthogonalised (<code>orthog = TRUE</code>). The serum bilirubin observations are clustered within individuals, so we can add a normally-distributed random intercept term named <code>M1</code>. The coefficient of the random-effect term will normally constrained to 1 using the <code>*1</code> notation, unless the random effect is being shared with another outcome model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r.int.model &lt;-<span class="st"> </span><span class="kw">merlin</span>(logb <span class="op">~</span><span class="st"> </span><span class="kw">rcs</span>(time, <span class="dt">df =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>M1[id]<span class="op">*</span><span class="dv">1</span>,
                      <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>,
                      <span class="dt">levels =</span> <span class="st">&quot;id&quot;</span>,
                      <span class="dt">timevar =</span> <span class="st">&quot;time&quot;</span>,
                      <span class="dt">data =</span> pbc)
<span class="kw">summary</span>(r.int.model)
<span class="co">#&gt; Mixed effects regression model </span>
<span class="co">#&gt; Log likelihood = -1978.61</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                      Coef. Std. Error      z P&gt;|z| [95% Conf.  Interval]</span>
<span class="co">#&gt; rcs():1         0.26636180  0.0136986  19.44 0.000  0.2395130  0.2932106</span>
<span class="co">#&gt; rcs():2         0.05859191  0.0130136   4.50 0.000  0.0330857  0.0840981</span>
<span class="co">#&gt; rcs():3         0.01669602  0.0126950   1.32 0.187 -0.0081857  0.0415778</span>
<span class="co">#&gt; _cons           0.61407632  0.0231746  26.50 0.000  0.5686549  0.6594977</span>
<span class="co">#&gt; log_sd(resid.) -0.61147721  0.0167757 -36.45 0.000 -0.6443570 -0.5785974</span>
<span class="co">#&gt; log_sd(M1)     -0.12796233  0.0196162  -6.52 0.000 -0.1664094 -0.0895153</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Integration method: Non-adaptive Gauss-Hermite quadrature </span>
<span class="co">#&gt; Integration points: 7</span>
<span class="co">#&gt;        Convergence: 0</span></code></pre></div>
<p>We can also add an additional random-slope term (<code>M2</code>) to the model by forming an interaction between the time variable and random-effect using <code>:</code>. We can increase the number of quadrature nodes to improve estimation of the likelihood using the <code>ip</code> option.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r.slope.model &lt;-<span class="st"> </span><span class="kw">merlin</span>(logb <span class="op">~</span><span class="st"> </span><span class="kw">rcs</span>(time, <span class="dt">df =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>M1[id]<span class="op">*</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>time<span class="op">:</span>M2[id]<span class="op">*</span><span class="dv">1</span>,
                        <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>,
                        <span class="dt">timevar =</span> <span class="st">&quot;time&quot;</span>,
                        <span class="dt">levels =</span> <span class="st">&quot;id&quot;</span>,
                        <span class="dt">ip =</span> <span class="dv">15</span>,
                        <span class="dt">data =</span> pbc)
<span class="kw">summary</span>(r.slope.model)
<span class="co">#&gt; Mixed effects regression model </span>
<span class="co">#&gt; Log likelihood = -1718.679</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                      Coef. Std. Error      z P&gt;|z| [95% Conf.  Interval]</span>
<span class="co">#&gt; rcs():1        -0.02441537  0.0165166  -1.48 0.139 -0.0567873  0.0079566</span>
<span class="co">#&gt; rcs():2        -0.02027941  0.0109475  -1.85 0.064 -0.0417361  0.0011773</span>
<span class="co">#&gt; rcs():3        -0.02530224  0.0094557  -2.68 0.007 -0.0438351 -0.0067694</span>
<span class="co">#&gt; _cons           0.23496435  0.0197921  11.87 0.000  0.1961726  0.2737562</span>
<span class="co">#&gt; log_sd(resid.) -1.01703279  0.0176869 -57.50 0.000 -1.0516985 -0.9823671</span>
<span class="co">#&gt; log_sd(M1)     -0.27673413  0.0214257 -12.92 0.000 -0.3187277 -0.2347405</span>
<span class="co">#&gt; log_sd(M2)     -1.43199974  0.0236142 -60.64 0.000 -1.4782827 -1.3857168</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Integration method: Non-adaptive Gauss-Hermite quadrature </span>
<span class="co">#&gt; Integration points: 15</span>
<span class="co">#&gt;        Convergence: 0</span></code></pre></div>
</div>
<div id="initial-estimates" class="section level2">
<h2>Initial estimates</h2>
<p>If a model has random effects, <code>merlin</code> will fit fixed effects models to obtain starting values and then assume an identity matrix for the variance of the random effects. Initial values can be manually set using the <code>from</code> option.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
